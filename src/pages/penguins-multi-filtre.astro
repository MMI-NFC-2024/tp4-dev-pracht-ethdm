---
import Layout from "../layouts/Layout.astro";
---

<Layout>
  <main>
    <h2>Filtres multiples</h2>
   

    <label for="species">Espèce :</label>
    <select id="species">
      <option value="">Toutes</option>
      <option value="Adelie">Adelie</option>
      <option value="Chinstrap">Chinstrap</option>
      <option value="Gentoo">Gentoo</option>
    </select>

    <label for="island">Île :</label>
    <select id="island">
      <option value="">Toutes</option>
      <option value="Biscoe">Biscoe</option>
      <option value="Dream">Dream</option>
      <option value="Torgersen">Torgersen</option>
    </select>

    <label for="sex">Sexe :</label>
    <select id="sex">
      <option value="">Tous</option>
      <option value="MALE">Male</option>
      <option value="FEMALE">Female</option>
    </select>

    <div id="plot"></div>
  </main>

  <script>
    import * as Plot from "@observablehq/plot";
    import penguins from "../assets/penguins.json";

    const selectSpecies = document.getElementById("species");
    const selectIsland = document.getElementById("island");
    const selectSex = document.getElementById("sex");
    const plotDiv = document.getElementById("plot");

    function renderPlot() {
      let filtered = penguins;

      if (selectSpecies.value) {
        filtered = filtered.filter(p => p.species === selectSpecies.value);
      }
      if (selectIsland.value) {
        filtered = filtered.filter(p => p.island === selectIsland.value);
      }
      if (selectSex.value) {
        filtered = filtered.filter(p => p.sex === selectSex.value);
      }

      plotDiv.innerHTML = "";

      if (filtered.length === 0) {
        plotDiv.innerHTML = "<p>Aucune donnée pour cette combinaison.</p>";
        return;
      }

      const plot = Plot.plot({
        marks: [
          Plot.dot(filtered, {
            x: "culmen_length_mm",
            y: "culmen_depth_mm",
            stroke: "species",
            tooltip: d => `${d.species}, ${d.island}, ${d.sex}`
          })
        ],
        width: 600,
        height: 400
      });

      plotDiv.appendChild(plot);
    }

    selectSpecies.addEventListener("change", renderPlot);
    selectIsland.addEventListener("change", renderPlot);
    selectSex.addEventListener("change", renderPlot);
    renderPlot();
  </script>
</Layout>